<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>UniConnect - Aplikasi Mahasiswa Terintegrasi V11 (Final with Percentage Fee)</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root{
            /* UniConnect Colors */
            --blue-900:#1e3a8a; --blue-700:#1d4ed8; --blue-600:#2563eb; --blue-500:#3b82f6;
            /* Utility Colors */
            --muted:#6b7280; 
            --bg-start: #eef2ff; /* Warna Biru Muda Awal */
            --bg-end: #f8fbff; /* Warna Biru Muda Akhir */
            --card:#ffffff;
            --shadow: 0 12px 40px rgba(2,6,23,0.08);
            --green-600:#059669;
            --red-600: #dc2626;
            --yellow-600: #f59e0b;
            --purple-600: #9333ea;
            --instagram: #E4405F; 
            --whatsapp: #25D366; 
        }
        *{box-sizing:border-box}
        /* Perubahan Background Body Menjadi Biru Muda Gradient */
        body{
            margin:0;
            font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
            color:#0f1724;
            background: linear-gradient(180deg, var(--bg-start) 0%, var(--bg-end) 100%);
            background-attachment: fixed;
            -webkit-font-smoothing:antialiased
        }
        a{color:inherit;text-decoration:none}
        /* Navbar & Utility */
        .navbar{height:64px;background:white;display:flex;align-items:center;justify-content:space-between;padding:0 26px;border-bottom:1px solid #eef2f7;position:sticky;top:0;z-index:50; box-shadow: 0 2px 10px rgba(0,0,0,0.05);}
        .brand{display:flex;align-items:center;gap:12px}
        /* Logo Image Style */
        .logo img {
            width: 40px; 
            height: 40px;
            object-fit: contain;
        }
        .brand h4{margin:0;font-weight:700}
        .navlinks{display:flex;gap:18px;align-items:center;color:var(--muted)}
        .navlinks a{font-weight:500;transition:color 0.2s}
        .navlinks a:hover{color:var(--blue-600)}
        .container{max-width:1150px;margin:28px auto;padding:0 18px}
        .split{display:grid;grid-template-columns:1fr 1fr;gap:28px;align-items:stretch}
        .card{background:var(--card);padding:34px;border-radius:12px;box-shadow:var(--shadow);border:1px solid #f1f5f9}
        .btn-primary{background:linear-gradient(180deg,var(--blue-500),var(--blue-600));color:white;padding:14px 20px;border-radius:14px;border:none;font-weight:700;cursor:pointer;box-shadow:0 12px 30px rgba(37,99,235,0.18);display:inline-flex;align-items:center;gap:10px;transition:opacity 0.2s}
        .btn-primary:disabled{opacity:0.6;cursor:not-allowed}
        .divider{height:1px;background:#f1f5f9;margin:20px 0;border-radius:8px}
        /* Hero & Services */
        .hero{padding:60px 0 30px 0;text-align:center;}
        .hero h2{font-size:56px;margin:0;line-height:1.02;font-weight:800}
        .cards-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:22px}
        .small-card{background:white;padding:18px;border-radius:14px;border:1px solid #f1f5f9;box-shadow:0 8px 18px rgba(2,6,23,0.04);position:relative}
        .card-title{display:flex;align-items:center;gap:12px;font-weight:700}
        .map-wrapper{margin-top:12px;border-radius:12px;overflow:hidden;border:1px solid #eef2f7;}
        /* Service Buttons & Items */
        .service-btn{padding:12px 16px;border-radius:12px;border:1px dashed #eef2f7;background:white;cursor:pointer;font-weight:600;color:var(--muted);transition:all 0.2s}
        .service-btn.active{background:#eef2ff;border:1px solid var(--blue-500);color:var(--blue-700);box-shadow:0 2px 8px rgba(37,99,235,0.1)}
        .service-item {padding: 12px; border-bottom: 1px solid #f1f5f9; display: flex; align-items: center; cursor: pointer; transition: background 0.2s; position: relative;}
        .service-item:hover { background: #f8fafc; }
        .item-icon { width: 48px; height: 48px; border-radius: 8px; background: #eef2f7; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0; margin-right: 12px; }
        /* Card Info UniConnect di Beranda */
        .uniconnect-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
        }
        .info-item {
            padding: 20px 30px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid #eef2f7;
            text-align: center;
            flex: 1;
            max-width: 250px;
        }
        .info-item .icon {
            font-size: 32px;
            margin-bottom: 8px;
        }
        .info-item .value {
            font-size: 24px;
            font-weight: 800;
            color: var(--blue-700);
        }
        .info-item .label {
            font-size: 14px;
            color: var(--muted);
            margin-top: -5px;
        }
        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 14px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            margin-bottom: 15px;
            border-bottom: 1px solid #f1f5f9;
        }
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--muted);
            transition: color 0.2s;
        }
        .close-btn:hover {
            color: var(--red-600);
        }
        .menu-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f8fafc;
        }
        .quantity-control {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .quantity-btn {
            background: var(--blue-500);
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }


        /* Footer & Fixed Buttons */
        .footer {
            padding: 20px 0;
            text-align: center;
            border-top: 1px solid #eef2f7;
            background: white;
            color: var(--muted);
            margin-top: 40px;
        }
        .footer-content {
            max-width: 1150px;
            margin: 0 auto;
            padding: 0 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        /* Ikon media sosial di footer */
        .social-links a {
            margin-left: 15px;
            transition: opacity 0.2s;
        }
        .social-links a:hover {
            opacity: 0.8;
        }
        /* Tombol WA Floating di kanan bawah */
        .fixed-action-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
        }
        .btn-whatsapp {
            background-color: var(--whatsapp);
            color: white;
            padding: 12px 18px;
            border-radius: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 8px 16px rgba(37, 211, 102, 0.3);
            transition: background-color 0.2s;
        }
        /* Success Notification Modal */
        #successNotification {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1500;
        }
        #successNotification .modal-content {
            text-align: center;
            max-width: 400px;
            padding: 30px;
        }
        #successNotification .modal-content h3 {
            color: var(--green-600);
            font-size: 24px;
        }
        #successNotification .modal-content .icon-success {
            font-size: 40px;
            margin-bottom: 15px;
        }

        /* Responsive */
        @media(max-width:980px){
            .split{grid-template-columns:1fr;gap:18px}
            .hero h2{font-size:36px}
            .cards-grid{grid-template-columns:1fr}
            .navbar{padding:0 12px;}
            /* Sembunyikan navigasi saat mobile */
            .navlinks a:not(#navHistory):not(#navProfile){display:none;}
            .footer-content { flex-direction: column; gap: 10px; }
            .social-links { margin-top: 10px; }
            .uniconnect-info { flex-direction: column; align-items: center; gap: 10px; }
            .info-item { max-width: 100%; width: 90%; }
        }
    </style>
</head>
<body>

    <div class="navbar" role="navigation">
        <div class="brand">
            <div class="logo">
                <img src="logo.jpeg" alt="UniConnect Logo" />
            </div>
            <div>
                <h4 style="margin:0">UniConnect</h4>
                <small style="color:var(--muted);font-weight:600">Terintegrasi Kampus</small>
            </div>
        </div>
        <div class="navlinks">
            <a href="#beranda" id="navBeranda">Beranda</a>
            <a href="#layanan" id="navLayanan">Layanan</a>
            <button id="navProfile" style="background:transparent;border:0;border-radius:999px;padding:6px 8px;cursor:pointer">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" style="opacity:0.95"><circle cx="12" cy="12" r="10" stroke="#cbd5e1" stroke-width="1.4"/><path d="M12 11.5a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM5 18c0-3 4-4.5 7-4.5s7 1.5 7 4.5" stroke="#cbd5e1" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
        </div>
    </div>

    <div class="container" id="loginContainer">
        <div class="split">
            <div class="left-panel" style="background:linear-gradient(180deg,var(--blue-900),var(--blue-700));color:white;padding:48px;border-radius:12px;position:relative;box-shadow:var(--shadow)">
                <div style="font-weight:700;font-size:36px;margin-bottom:12px;">UniConnect</div>
                <h1>Portal Mahasiswa<br>UIGM Palembang</h1>
                <p>Akses cepat ke semua kebutuhan kampus dan layanan terdekat.</p>
                <div style="position:absolute;left:26px;bottom:18px;color:rgba(255,255,255,0.85);font-size:13px;">üîí SSO Integrated</div>
            </div>

            <div class="card" aria-labelledby="loginHeading">
                <h2 id="loginHeading" class="form-title" style="font-weight:800; font-size:28px; color:var(--blue-700);">Masuk Akun SSO</h2>
                <div class="subtitle" style="margin-bottom:25px;">Gunakan akun resmi kampus Anda.</div>
                
                <div style="display:flex;align-items:center;gap:12px;padding:14px;border-radius:12px;background:#f8fafc;border:1px solid #eef2f7;margin-bottom:14px">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" style="opacity:0.6"><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7" stroke="#94a3b8" stroke-width="1.2"/><circle cx="12" cy="7" r="4" stroke="#94a3b8" stroke-width="1.2"/></svg>
                    <input id="email" type="email" placeholder="Email (contoh: user@uigmpalembang.ac.id)" style="border:0;background:transparent;outline:none;font-size:15px;width:100%" />
                </div>
                
                <div style="display:flex;align-items:center;gap:12px;padding:14px;border-radius:12px;background:#f8fafc;border:1px solid #eef2f7;margin-bottom:30px">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" style="opacity:0.6"><rect x="3" y="11" width="18" height="11" rx="2" stroke="#94a3b8" stroke-width="1.2"/><path d="M7 11V8a5 5 0 0 1 10 0v3" stroke="#94a3b8" stroke-width="1.2"/></svg>
                    <input id="password" type="password" placeholder="Kata Sandi (6 Karakter)" style="border:0;background:transparent;outline:none;font-size:15px;width:100%" />
                </div>
                
                <button class="btn-primary" id="loginBtn" style="width:100%">Masuk</button>
            </div>
        </div>
    </div>

    <section class="hero" id="beranda" style="display:none;padding-top:52px">
        <div class="container">
            <span style="display:inline-block;padding:6px 12px;border-radius:22px;background:#e6f3ff;color:var(--blue-600);font-weight:700;font-size:13px">üëã Selamat Datang di UniConnect</span>
            <h2>Semua Kebutuhan Kampus<br><span style="color:var(--blue-600)">Dalam Satu Aplikasi</span></h2>
            <p>Jelajahi layanan terdekat, mulai dari tempat tinggal, kebersihan, hingga transportasi.</p>
            
            <div class="uniconnect-info">
                <div class="info-item">
                    <div class="icon">üí°</div>
                    <div class="value">Motto</div>
                    <div class="label">University Life Made Easy</div>
                </div>
                <div class="info-item">
                    <div class="icon">üè´</div>
                    <div class="value">12+</div>
                    <div class="label">Layanan Kampus Terintegrasi</div>
                </div>
                <div class="info-item">
                    <div class="icon">üë®‚Äçüéì</div>
                    <div class="value">5000+</div>
                    <div class="label">Pengguna Aktif Mahasiswa</div>
                </div>
            </div>
            </div>
    </section>

    <div class="container section" id="layanan" style="display:none">
        
        <div class="cards-grid" style="margin-top:22px">
            <div class="small-card">
                <div class="card-title"><div style="width:44px;height:44px;border-radius:10px;background:#eef2ff;display:flex;align-items:center;justify-content:center">üìç</div><div>Peta Lokasi Kampus</div></div>
                <div style="color:var(--muted); font-size:13px; margin-top:4px;">Lokasi penting di sekitar UIGM Palembang.</div>
                <div class="map-wrapper" style="margin-top:12px;">
                    <iframe
                        width="100%"
                        height="340"
                        style="border:0; border-radius:12px;"
                        loading="lazy"
                        allowfullscreen
                        src="https://www.google.com/maps?q=Palembang%2C%20Sumatera%20Selatan&z=14&output=embed">
                    </iframe>
                    <div style="position:absolute; bottom:10px; left:10px; padding:6px 12px; background:rgba(255,255,255,0.9); border-radius:8px; font-size:12px; font-weight:600; color:var(--blue-700);">
                        Simulasi Lokasi UIGM
                    </div>
                </div>
            </div>

            <div class="small-card">
                <div class="card-title"><div style="width:44px;height:44px;border-radius:10px;background:#fefce8;display:flex;align-items:center;justify-content:center">üí°</div><div>Layanan Terdekat Kampus</div></div>
                <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
                    <button class="service-btn active" data-service="Kos">Kos</button>
                    <button class="service-btn" data-service="Laundry">Laundry</button>
                    <button class="service-btn" data-service="Ojek">Ojek</button>
                    <button class="service-btn" data-service="Kantin">Kantin</button>
                    <button class="service-btn" data-service="Fotokopi">Fotokopi</button>
                </div>

                <div id="kosFilterControls" style="margin-top:15px; display:flex; gap:8px; align-items:center; border-bottom:1px solid #eef2f7; padding-bottom:12px;">
                    <input id="searchKos" placeholder="Cari nama kos..." style="flex:1; padding:10px; border-radius:8px; border:1px solid #eef2f7; background:white; font-size:14px;" />
                    <button id="btnFilterSemua" data-filter="Semua" class="btn-secondary" style="background:#eef2ff; color:var(--blue-700); font-weight:700;">Semua</button>
                    <button id="btnFilterPutri" data-filter="Putri" class="btn-secondary">Putri</button>
                    <button id="btnFilterPutra" data-filter="Putra" class="btn-secondary">Putra</button>
                </div>

                <div id="serviceList" style="margin-top:18px;border-radius:12px;border:1px solid #eef2f7;overflow:hidden">
                    </div>
            </div>
        </div>
    </div>
    
    <div id="serviceDetailModal" class="modal" style="display:none;"></div>
    <div id="kantinDetailModal" class="modal" style="display:none;"></div>
    <div id="checkoutModal" class="modal" style="display:none;"></div>
    
    <div class="container section" id="historySection" style="display:none">
        <h2 style="font-weight:800; border-bottom:1px solid #eef2f7; padding-bottom:12px; margin-top:0; color:var(--blue-700);">üìú Riwayat Transaksi</h2>
        <div id="transactionList" style="display:flex; flex-direction:column; gap:12px;">
            <div style="padding:20px; text-align:center; color:var(--muted); border:1px dashed #eef2f7; border-radius:12px;">
                Belum ada transaksi yang berhasil.
            </div>
        </div>
    </div>

    <div id="successNotification" class="modal">
        <div class="modal-content">
            <div class="icon-success">‚úÖ</div>
            <h3 id="successTitle">Pembayaran Berhasil!</h3>
            <p id="successMessage" style="font-size:14px; margin-bottom: 20px;">Transaksi Anda sudah dicatat.</p>
            <button class="btn-primary" style="width:100%; margin-bottom: 10px;" onclick="closeAndNavigate('layanan')">Pesan Layanan Lagi</button>
            <button class="btn-primary" style="width:100%; background: var(--green-600);" onclick="closeAndNavigate('beranda')">Kembali ke Beranda</button>
        </div>
    </div>

    <a href="https://wa.me/62895328839840?text=Halo%2C%20saya%20menemukan%20bug%20di%20aplikasi%20UniConnect.%20[Jelaskan%20masalah%20di%20sini]" 
        target="_blank" 
        class="fixed-action-btn btn-whatsapp">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="white"><path d="M12 2C6.477 2 2 6.477 2 12c0 3.189 1.353 6.075 3.515 8.125L4 22l2.365-.77c1.884 1.026 4.02 1.637 6.182 1.637 5.523 0 10-4.477 10-10S17.523 2 12 2zM17.152 16.92c-.225-.113-.827-.406-.96-.457-.134-.05-.23-.075-.324.075-.095.15-.368.457-.45.554-.084.098-.168.117-.314.045-.145-.07-.61-.225-1.16-.715-.457-.39-.766-.65-.855-.802-.09-.15-.01-.23.064-.314.075-.075.168-.198.25-.293.084-.095.112-.15.168-.262.056-.113.028-.21-.015-.293-.045-.095-.324-.775-.447-1.06-.12-.285-.24-.246-.324-.257-.084-.01-.178-.01-.272-.01-.095 0-.25.038-.385.19-.136.15-.52.5-.52 1.21s.534 1.403.607 1.507c.074.104 1.04 1.595 2.515 2.296.357.168.632.262.855.334.37.116.704.099.967.062.297-.038.827-.346.942-.682.115-.336.115-.62.083-.683-.03-.062-.12-.095-.256-.15z"/></svg>
        Laporkan Bug/Bantuan
    </a>

    <div class="footer">
        <div class="footer-content">
            <div class="copyright" style="font-size:14px; color:#475569;">
                ¬© 2025 UniConnect by Yesa Damayanti
            </div>
            
            <div class="social-links">
                <a href="https://instagram.com/uniconnect___" target="_blank" title="Instagram UniConnect" style="color:var(--instagram);">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-instagram"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
                </a>
                <a href="https://wa.me/62895328839840" target="_blank" title="WhatsApp Bantuan" style="color:var(--whatsapp);">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.477 2 2 6.477 2 12c0 3.189 1.353 6.075 3.515 8.125L4 22l2.365-.77c1.884 1.026 4.02 1.637 6.182 1.637 5.523 0 10-4.477 10-10S17.523 2 12 2zM17.152 16.92c-.225-.113-.827-.406-.96-.457-.134-.05-.23-.075-.324.075-.095.15-.368.457-.45.554-.084.098-.168.117-.314.045-.145-.07-.61-.225-1.16-.715-.457-.39-.766-.65-.855-.802-.09-.15-.01-.23.064-.314.075-.075.168-.198.25-.293.084-.095.112-.15.168-.262.056-.113.028-.21-.015-.293-.045-.095-.324-.775-.447-1.06-.12-.285-.24-.246-.324-.257-.084-.01-.178-.01-.272-.01-.095 0-.25.038-.385.19-.136.15-.52.5-.52 1.21s.534 1.403.607 1.507c.074.104 1.04 1.595 2.515 2.296.357.168.632.262.855.334.37.116.704.099.967.062.297-.038.827-.346.942-.682.115-.336.115-.62.083-.683-.03-.062-.12-.095-.256-.15z"/></svg>
                </a>
            </div>
        </div>
    </div>

    <script>
        // --- KONSTANTA PERHITUNGAN BARU ---
        const ADMIN_FEE_PERCENTAGE = 0.02; // 2% Biaya Admin

        // --- DATA SIMULASI UTAMA (10 ITEM PER JENIS) ---
        const kosNames = ["Kos Melati", "Kos Bahagia", "Kos Elite UIGM", "Wisma Cerdas", "Kos Cempaka", "Graha Putra", "Asrama Mahasiswi", "Kos Amanah", "Kostel Bintang", "Kos Exclusive"];
        const laundryNames = ["Sinar Kilat", "Bersih Kinclong", "Wash & Go", "Laundry Cepat", "Jemur Kering", "Express 1 Jam", "Hemat Bersih", "Wangi Selalu", "Dry Clean Kampus", "Kilau Pakaian"];
        const ojekNames = ["Ojol UniRide", "Mobil UniCar", "Ojek Kampus", "Kurir Cepat", "UniExpress Motor", "UniExpress Mobil", "Ojek Mahasiswa", "RideNow", "CarNow", "Delivery Cepat"];
        const fotokopiNames = ["Fotokopi Cepat", "Percetakan Digital", "Print Murah", "Jilid Express", "Copy Center", "Layanan Skripsi", "Print Warna", "Fotokopi 24 Jam", "Maju Jaya", "Sumber Ilmu"];
        const warungNames = ["Warung Bu Siti", "Kantin Pak Budi", "Warung Mami", "Nasi Uduk Bang J", "Soto Madura", "Mie Ayam Spesial", "Pondok Gorengan", "Warung Gaul", "Fresh Juice Bar", "Kopi Kampus"];

        const allKantinMenus = [
            { id: 1, name: "Nasi Ayam Geprek", price: 15000, qty: 0 },
            { id: 2, name: "Nasi Goreng Spesial", price: 18000, qty: 0 },
            { id: 3, name: "Mie Ayam Bakso", price: 14000, qty: 0 },
            { id: 4, name: "Soto Ayam", price: 12000, qty: 0 },
            { id: 5, name: "Capcay Kuah", price: 16000, qty: 0 },
            { id: 6, name: "Es Teh Manis", price: 4000, qty: 0 },
            { id: 7, name: "Jus Alpukat", price: 10000, qty: 0 },
            { id: 8, name: "Ayam Penyet", price: 17000, qty: 0 },
            { id: 9, name: "Indomie Rebus + Telur", price: 9000, qty: 0 },
            { id: 10, name: "Nasi Uduk Komplit", price: 15000, qty: 0 }
        ];

        function generateSimulatedData(nameArray, basePrice, unit, serviceType, icon) {
            return nameArray.map((name, index) => {
                const id = (index + 1) * 10;
                const dist = `${(0.5 + index * 0.15).toFixed(1)} km`;
                const price = basePrice + (index % 3) * (serviceType === 'Kos' ? 50000 : 0);
                let desc = "";
                let type = "";
                
                if (serviceType === 'Kos') {
                    desc = `Fasilitas standar, ${index % 2 === 0 ? 'Kamar Mandi Dalam.' : 'Kamar Mandi Luar.'}`;
                    type = index % 2 === 0 ? "Putri" : "Putra";
                } else if (serviceType === 'Laundry') {
                    desc = `Layanan ${index % 2 === 0 ? 'kilat 1 hari.' : 'reguler 2 hari.'}`;
                    type = index % 2 === 0 ? "Cepat" : "Reguler";
                } else if (serviceType === 'Ojek') {
                    desc = `Layanan ${index % 2 === 0 ? 'motor UniRide' : 'mobil UniCar'} terdekat.`;
                    type = index % 2 === 0 ? "Motor" : "Mobil";
                } else if (serviceType === 'Fotokopi') {
                    desc = `Harga fotokopi ${index % 2 === 0 ? 'Rp 200/lembar (B/W).' : 'Rp 500/lembar (Warna).'}`;
                    type = index % 2 === 0 ? "B/W" : "Warna";
                } else if (serviceType === 'Kantin') {
                    desc = `Warung makan mahasiswa, menu bervariasi.`;
                    type = index % 2 === 0 ? "Buka" : "Tutup";
                }

                return {
                    id: id,
                    name: name,
                    price: price,
                    dist: dist,
                    unit: unit,
                    desc: desc,
                    type: type,
                    icon: icon,
                    contact: `08XX-${Math.floor(Math.random() * 9000) + 1000}-${Math.floor(Math.random() * 9000) + 1000}`,
                    paymentMethod: index % 3 === 0 ? "Transfer Bank, E-Wallet" : "E-Wallet, Tunai",
                    menus: serviceType === 'Kantin' ? JSON.parse(JSON.stringify(allKantinMenus)) : [] // Deep copy menus
                };
            });
        }

        const allServicesData = {
            Kos: generateSimulatedData(kosNames, 750000, "Bulan", 'Kos', 'üè†'),
            Laundry: generateSimulatedData(laundryNames, 6500, "Kg", 'Laundry', 'üß∫'),
            Ojek: generateSimulatedData(ojekNames, 7000, "Trip", 'Ojek', 'üõµ'),
            Kantin: generateSimulatedData(warungNames, 8000, "Item", 'Kantin', 'üçΩÔ∏è'),
            Fotokopi: generateSimulatedData(fotokopiNames, 200, "Lbr", 'Fotokopi', 'üñ®Ô∏è')
        };
        
        let transactionHistory = []; 

        // --- DOM ELEMENTS & VARIABLES ---
        const loginBtn = document.getElementById('loginBtn');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const loginContainer = document.getElementById('loginContainer');
        const hero = document.querySelector('.hero');
        const layananSection = document.getElementById('layanan');
        const serviceList = document.getElementById('serviceList');
        const mainServiceBtns = document.querySelectorAll('.service-btn');
        const kosFilterControls = document.getElementById('kosFilterControls');
        const searchKosInput = document.getElementById('searchKos');
        const filterBtns = document.querySelectorAll('[id^="btnFilter"]');
        
        const serviceDetailModal = document.getElementById('serviceDetailModal');
        const kantinDetailModal = document.getElementById('kantinDetailModal');
        const checkoutModal = document.getElementById('checkoutModal');
        const successNotification = document.getElementById('successNotification');
        
        let currentService = 'Kos';
        let currentItemForBooking = null; 
        let currentKantinSelections = []; 
        
        const formatRupiah = (number) => `Rp ${Math.round(number).toLocaleString('id-ID')}`;

        // --- FUNGSI NAVIGASI ---
        function navigate(sectionId) {
            // Sembunyikan semua section utama
            loginContainer.style.display = 'none';
            hero.style.display = 'none';
            layananSection.style.display = 'none';
            document.getElementById('historySection').style.display = 'none';
            
            // Tutup semua modal jika ada
            closeModal('serviceDetailModal');
            closeModal('kantinDetailModal');
            closeModal('checkoutModal');
            closeModal('successNotification');


            // Tampilkan section yang diminta
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.style.display = 'block';
            }

            // Update styling navigasi aktif
            document.querySelectorAll('.navlinks a').forEach(a => a.style.fontWeight = '500');
            
            let navId = '';
            if (sectionId === 'historySection') {
                navId = 'navHistory';
                renderTransactionHistory();
            } else if (sectionId === 'layanan') {
                navId = 'navLayanan';
            } else if (sectionId === 'beranda') {
                navId = 'navBeranda';
            }
            
            const activeNav = document.getElementById(navId);
            if (activeNav) {
                activeNav.style.fontWeight = '700';
            }
        }
        
        function closeAndNavigate(sectionId) {
            closeModal('successNotification');
            navigate(sectionId);
        }

        // --- FUNGSI RENDER LAYANAN ---
        function renderServiceList(service, filter = 'Semua', searchQuery = '') {
            currentService = service;
            
            // Tampilkan atau sembunyikan filter Kos
            kosFilterControls.style.display = service === 'Kos' ? 'flex' : 'none';
            
            // Update tampilan tombol filter Kos
            if (service !== 'Kos') {
                // Reset filter Kos jika pindah layanan
                filterBtns.forEach(btn => {
                    btn.style.background = 'white';
                    btn.style.color = 'var(--muted)';
                    btn.style.fontWeight = '600';
                });
                document.getElementById('btnFilterSemua').style.background = '#eef2ff';
                document.getElementById('btnFilterSemua').style.color = 'var(--blue-700)';
                document.getElementById('btnFilterSemua').style.fontWeight = '700';
            }
            
            let filteredData = allServicesData[service] || [];

            // Filter berdasarkan jenis (hanya Kos)
            if (service === 'Kos' && filter !== 'Semua') {
                filteredData = filteredData.filter(item => item.type === filter);
            }
            
            // Filter berdasarkan pencarian nama
            if (searchQuery) {
                filteredData = filteredData.filter(item => item.name.toLowerCase().includes(searchQuery.toLowerCase()));
            }

            let htmlContent = '';

            if (filteredData.length === 0) {
                htmlContent = `<div style="padding:20px; text-align:center; color:var(--muted);">Tidak ada ${service.toLowerCase()} yang ditemukan.</div>`;
            } else {
                htmlContent = filteredData.map(item => `
                    <div class="service-item" data-id="${item.id}" data-service-type="${service}">
                        <div class="item-icon" style="background:${service === 'Kantin' ? '#fffbeb' : '#eef2ff'};">${item.icon}</div>
                        <div style="flex:1;">
                            <div style="font-weight:700; color:#0f172a;">${item.name}</div>
                            <div style="font-size:13px; color:var(--muted);">${item.desc}</div>
                        </div>
                        <div style="text-align:right; flex-shrink:0;">
                            <div style="font-weight:700; color:var(--green-600); font-size:14px;">${formatRupiah(item.price)}</div>
                            <div style="font-size:12px; color:var(--muted);">/${item.unit} (${item.dist})</div>
                        </div>
                    </div>
                `).join('');
            }

            serviceList.innerHTML = htmlContent;
            
            // Tambahkan kembali event listener setelah konten diperbarui
            document.querySelectorAll('.service-item').forEach(item => {
                item.addEventListener('click', handleServiceClick);
            });
        }
        
        function handleServiceClick(e) { 
            const id = parseInt(e.currentTarget.dataset.id);
            const serviceType = e.currentTarget.dataset.serviceType;
            const item = allServicesData[serviceType].find(i => i.id === id);
            
            if (item) {
                currentItemForBooking = item;
                if (serviceType === 'Kantin') {
                    showKantinDetailModal(item);
                } else {
                    showServiceDetailModal(item);
                }
            }
        }
        
        // --- MODAL & CHECKOUT FUNCTIONS ---

        function showServiceDetailModal(item) {
            let actionText = '';
            if (item.unit === 'Bulan') actionText = 'Pesan Sekarang';
            else if (item.unit === 'Kg') actionText = 'Hitung & Pesan';
            else actionText = 'Pesan Layanan';

            serviceDetailModal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 style="margin:0;">Detail ${currentService}: ${item.name}</h3>
                        <button class="close-btn" onclick="closeModal('serviceDetailModal')">√ó</button>
                    </div>
                    <p style="font-size:14px; color:var(--muted);">${item.desc}</p>
                    
                    <div style="padding:15px; background:#f8fafc; border-radius:10px; margin-bottom:15px;">
                        <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                            <span style="font-weight:600;">Harga:</span> 
                            <span style="font-weight:700; color:var(--green-600);">${formatRupiah(item.price)}/${item.unit}</span>
                        </div>
                        <div style="display:flex; justify-content:space-between;">
                            <span style="font-weight:600;">Jarak:</span> 
                            <span>${item.dist}</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-top:8px;">
                            <span style="font-weight:600;">Tipe:</span> 
                            <span>${item.type}</span>
                        </div>
                    </div>
                    
                    <div style="margin-bottom:20px;">
                        <h4 style="margin-bottom:5px; font-size:16px;">Kontak & Pembayaran</h4>
                        <p style="font-size:14px;">Kontak Pemilik: <span style="font-weight:600;">${item.contact}</span></p>
                        <p style="font-size:14px;">Metode Pembayaran: <span style="font-weight:600;">${item.paymentMethod}</span></p>
                    </div>
                    
                    <button class="btn-primary" style="width:100%" onclick="showCheckoutModal('${item.unit}')">
                        ${actionText}
                    </button>
                </div>
            `;
            serviceDetailModal.style.display = 'flex';
        }

        function showKantinDetailModal(item) {
            currentKantinSelections = item.menus.map(menu => ({ ...menu })); // Deep copy for current order
            renderKantinMenu();
            kantinDetailModal.style.display = 'flex';
        }

        function renderKantinMenu() {
            const item = currentItemForBooking;
            let menuHtml = '';
            let totalOrder = 0;
            
            currentKantinSelections.forEach(menu => {
                totalOrder += menu.price * menu.qty;
                menuHtml += `
                    <div class="menu-item" data-id="${menu.id}">
                        <div>
                            <div style="font-weight:600;">${menu.name}</div>
                            <div style="font-size:13px; color:var(--green-600);">${formatRupiah(menu.price)}</div>
                        </div>
                        <div class="quantity-control">
                            <button class="quantity-btn" onclick="updateKantinQuantity(${menu.id}, -1)">-</button>
                            <span id="qty-${menu.id}">${menu.qty}</span>
                            <button class="quantity-btn" onclick="updateKantinQuantity(${menu.id}, 1)">+</button>
                        </div>
                    </div>
                `;
            });
            
            kantinDetailModal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 style="margin:0;">Pesan di Kantin: ${item.name}</h3>
                        <button class="close-btn" onclick="closeModal('kantinDetailModal')">√ó</button>
                    </div>
                    <p style="font-size:14px; color:var(--muted);">Silakan pilih menu yang ingin Anda pesan.</p>
                    
                    <div style="max-height: 300px; overflow-y: auto; border: 1px solid #eef2f7; border-radius: 8px; margin-bottom: 15px; padding: 0 10px;">
                        ${menuHtml}
                    </div>

                    <div style="display:flex; justify-content:space-between; align-items:center; padding:15px 0; border-top:1px solid #f1f5f9;">
                        <span style="font-weight:700;">Total Pesanan:</span>
                        <span id="kantinTotal" style="font-size:18px; font-weight:800; color:var(--blue-700);">${formatRupiah(totalOrder)}</span>
                    </div>

                    <button class="btn-primary" style="width:100%" ${totalOrder === 0 ? 'disabled' : ''} onclick="prepareKantinCheckout(${totalOrder})">
                        Lanjut ke Pembayaran (${formatRupiah(totalOrder)})
                    </button>
                </div>
            `;
        }

        function updateKantinQuantity(menuId, change) {
            const menu = currentKantinSelections.find(m => m.id === menuId);
            if (menu) {
                menu.qty = Math.max(0, menu.qty + change);
                renderKantinMenu(); // Re-render modal untuk update tampilan
            }
        }

        function prepareKantinCheckout(totalAmount) {
            const selectedItems = currentKantinSelections.filter(m => m.qty > 0);
            if (selectedItems.length > 0) {
                closeModal('kantinDetailModal');
                showCheckoutModal('Kantin', totalAmount, selectedItems);
            }
        }

        function showCheckoutModal(serviceType, customPrice = null, selectedItems = []) {
            let subtotalTagihan;
            let transactionDesc;

            if (serviceType === 'Kantin' && customPrice !== null) {
                subtotalTagihan = customPrice;
                transactionDesc = selectedItems.map(item => `${item.name} x${item.qty}`).join(', ');
            } else {
                // Untuk Kos, Laundry, Ojek, Fotokopi (Simulasi pemesanan 1 item)
                subtotalTagihan = currentItemForBooking.price;
                transactionDesc = currentItemForBooking.name;
            }
            
            // HITUNG BIAYA ADMIN (2% dari subtotal)
            const biayaAdmin = subtotalTagihan * ADMIN_FEE_PERCENTAGE;
            const totalAkhir = subtotalTagihan + biayaAdmin;

            checkoutModal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 style="margin:0;">Konfirmasi Pembayaran</h3>
                        <button class="close-btn" onclick="closeModal('checkoutModal')">√ó</button>
                    </div>
                    
                    <p style="font-size:16px;">Anda akan melakukan pembayaran untuk layanan:</p>
                    
                    <div style="padding:15px; background:#eef2ff; border-radius:10px; margin-bottom:20px;">
                        <div style="font-weight:700; color:var(--blue-700); margin-bottom:5px;">${currentService} (${currentItemForBooking.name})</div>
                        <div style="font-size:14px; color:var(--muted);">${transactionDesc}</div>
                    </div>
                    
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span style="font-weight:500;">Subtotal Tagihan:</span>
                        <span style="font-weight:600;">${formatRupiah(subtotalTagihan)}</span>
                    </div>
                    
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <span style="font-weight:500;">Biaya Admin (2%):</span>
                        <span style="font-weight:600; color:var(--red-600);">${formatRupiah(biayaAdmin)}</span>
                    </div>

                    <div class="divider"></div>

                    <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                        <span style="font-weight:700;">TOTAL AKHIR:</span>
                        <span id="finalTotal" style="font-size:24px; font-weight:800; color:var(--blue-700);" data-amount="${totalAkhir}">${formatRupiah(totalAkhir)}</span>
                    </div>
                    
                    <div style="margin-bottom:25px;">
                        <label for="paymentMethod" style="font-weight:600; display:block; margin-bottom:8px;">Pilih Metode Pembayaran</label>
                        <select id="paymentMethod" style="width:100%; padding:12px; border-radius:8px; border:1px solid #eef2f7; background:white;">
                            <option value="e-wallet">E-Wallet (Dana/Gopay/OVO)</option>
                            <option value="transfer">Transfer Bank (BCA/Mandiri)</option>
                            <option value="cash">Bayar di Tempat (Tunai)</option>
                        </select>
                    </div>

                    <button class="btn-primary" style="width:100%;" onclick="processPayment('${serviceType}', ${totalAkhir}, '${transactionDesc}', ${biayaAdmin})">
                        Bayar Sekarang ${formatRupiah(totalAkhir)}
                    </button>
                </div>
            `;
            checkoutModal.style.display = 'flex';
        }

        function processPayment(serviceType, amount, description, adminFee) {
            closeModal('checkoutModal');
            
            // Simulasi proses pembayaran
            setTimeout(() => {
                const transaction = {
                    date: new Date().toLocaleDateString('id-ID', { day: '2-digit', month: 'short', year: 'numeric' }),
                    service: serviceType,
                    name: currentItemForBooking.name,
                    description: description,
                    amount: amount,
                    status: 'Sukses'
                };
                transactionHistory.unshift(transaction); // Tambahkan ke depan
                
                // 1. Arahkan ke Riwayat Transaksi
                navigate('historySection'); 
                
                // 2. Tampilkan notifikasi sukses 
                document.getElementById('successMessage').innerHTML = `Anda telah membayar <b>${formatRupiah(amount)}</b> (Termasuk Biaya Admin <b>${formatRupiah(adminFee)}</b>) untuk ${description}.`;
                successNotification.style.display = 'flex';


            }, 500);
        }

        function renderTransactionHistory() {
            const list = document.getElementById('transactionList');
            if (transactionHistory.length === 0) {
                list.innerHTML = `<div style="padding:20px; text-align:center; color:var(--muted); border:1px dashed #eef2f7; border-radius:12px;">
                    Belum ada transaksi yang berhasil.
                </div>`;
                return;
            }

            list.innerHTML = transactionHistory.map(t => `
                <div style="padding:15px; border-radius:10px; border:1px solid #eef2f7; background:white;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div style="font-weight:700; color:var(--blue-700);">${t.service} - ${t.name}</div>
                        <span style="font-size:12px; color:var(--muted);">${t.date}</span>
                    </div>
                    <div style="font-size:13px; color:var(--muted); margin-top:3px;">${t.description}</div>
                    <div style="display:flex; justify-content:space-between; margin-top:10px;">
                        <span style="padding:4px 8px; border-radius:6px; font-size:12px; font-weight:600; background:#dcfce7; color:var(--green-600);">${t.status}</span>
                        <span style="font-weight:800; color:var(--red-600);">${formatRupiah(t.amount)}</span>
                    </div>
                </div>
            `).join('');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // --- EVENT LISTENERS & INISIALISASI ---
        
        // Login (Validasi Sederhana: harus diisi)
        loginBtn.addEventListener('click', (e) => {
            e.preventDefault();
            if (emailInput.value.trim() !== "" && passwordInput.value.trim() !== "") {
                navigate('beranda'); // Pindah ke Beranda setelah login
                renderServiceList('Kos', 'Semua');
                
                // Tampilkan semua navlinks
                document.querySelectorAll('.navlinks a').forEach(a => a.style.display = 'inline-block');
                
                const navlinks = document.querySelector('.navlinks');
                if (!document.getElementById('navHistory')) {
                    const profileBtn = document.getElementById('navProfile');
                    const historyLink = document.createElement('a');
                    historyLink.href = "#riwayat";
                    historyLink.textContent = "Riwayat";
                    historyLink.id = "navHistory";
                    historyLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        navigate('historySection');
                    });
                    navlinks.insertBefore(historyLink, profileBtn);
                }
                document.getElementById('navBeranda').style.fontWeight = '700';
            } else {
                alert('Mohon isi Email dan Kata Sandi.');
            }
        });
        
        document.getElementById('navBeranda').addEventListener('click', (e) => { e.preventDefault(); navigate('beranda'); });
        document.getElementById('navLayanan').addEventListener('click', (e) => { 
            e.preventDefault(); 
            navigate('layanan'); 
            // Pastikan Kos adalah default saat masuk ke Layanan
            renderServiceList('Kos');
            mainServiceBtns.forEach(b => b.classList.remove('active'));
            document.querySelector('[data-service="Kos"]').classList.add('active');
            
            // Mengatur style tombol Kos menjadi aktif
            document.querySelector('[data-service="Kos"]').style.background = '#eef2ff'; 
            document.querySelector('[data-service="Kos"]').style.border = '1px solid var(--blue-500)';
            document.querySelector('[data-service="Kos"]').style.color = 'var(--blue-700)';
        });
        
        filterBtns.forEach(btn => { 
            btn.addEventListener('click', function() {
                filterBtns.forEach(b => {
                    b.style.background = 'white';
                    b.style.color = 'var(--muted)';
                    b.style.fontWeight = '600';
                });
                this.style.background = '#eef2ff'; 
                this.style.color = 'var(--blue-700)';
                this.style.fontWeight = '700';
                updateKosView(this.dataset.filter);
            });
        });
        
        searchKosInput.addEventListener('input', () => updateKosView());
        function updateKosView(filterOverride) { 
            const currentFilterBtn = document.querySelector('#kosFilterControls .btn-secondary[style*="background:#eef2ff"]');
            const currentFilter = filterOverride || (currentFilterBtn ? currentFilterBtn.dataset.filter : 'Semua');
            const searchQuery = searchKosInput.value;
            renderServiceList('Kos', currentFilter, searchQuery);
        }
        
        mainServiceBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                mainServiceBtns.forEach(b => {
                    b.classList.remove('active');
                    b.style.background = 'white';
                    b.style.border = '1px dashed #eef2f7';
                    b.style.color = 'var(--muted)';
                });
                this.classList.add('active');
                
                this.style.background = '#eef2ff'; 
                this.style.border = '1px solid var(--blue-500)';
                this.style.color = 'var(--blue-700)';

                renderServiceList(this.dataset.service);
            });
        });

        document.addEventListener('DOMContentLoaded', () => {
            navigate('loginContainer'); 
            // Sembunyikan link navbar saat belum login
            document.querySelectorAll('.navlinks a').forEach(a => a.style.display = 'none');
        });
    </script>
</body>
</html>

